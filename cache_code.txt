        // Add status history record
        const now = Date.now();
        try {
          await env.DB.prepare(`
            INSERT INTO order_status_history (order_id, status, timestamp, updated_by)
            VALUES (?, ?, ?, ?)
          `).bind(orderId, status, now, processedBy || 'admin').run();
        } catch (e) {
          console.warn('Failed to record status history:', e.message);
        }

        // Clear cache
        try {
          await env.CACHE.delete('tracking:' + orderId);
          console.log('Cache cleared for order:', orderId);
        } catch (e) {
          console.warn('Cache delete failed:', e.message);
        }