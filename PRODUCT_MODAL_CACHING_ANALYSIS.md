# ๐ ุชุญููู ุงูู Caching ูู ProductModal

## ๐ ูุง ุชุดููู ูู ุงูููุฌุฒ

```
๐ก API Request [GET]: /products/14?expand=addons,ingredients,allergens
๐ก API Request [GET]: /products/13?expand=addons,ingredients,allergens
๐ก API Request [GET]: /products/12?expand=addons,ingredients,allergens
๐ก API Request [GET]: /products/18?expand=addons,ingredients,allergens
๐ก API Request [GET]: /products/19?expand=addons,ingredients,allergens
```

---

## โ ุงูุณุคุงู: ูู ุฏู ุงุณุชููุงู ุนูู ุงููุงุถูุ

### ุงูุฅุฌุงุจุฉ: โ **ูุง! ุฏู ุณููู ุทุจูุนู ููุญุณูู**

---

## ๐ฏ ุงูุชูุณูุฑ

### 1. ูู ููุชุฌ = Request ูุงุญุฏ ููุท

```
ุงูููุชุฌ 14 โ Request ูุงุญุฏ โ Cache ููุฏุฉ 5 ุฏูุงุฆู
ุงูููุชุฌ 13 โ Request ูุงุญุฏ โ Cache ููุฏุฉ 5 ุฏูุงุฆู
ุงูููุชุฌ 12 โ Request ูุงุญุฏ โ Cache ููุฏุฉ 5 ุฏูุงุฆู
```

**ูููุ**
- ูู ููุชุฌ ูู ุจูุงูุงุช ูุฎุชููุฉ (addons, ingredients, allergens)
- ูุงุฒู ูุฌูุจ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูู ููุชุฌ

---

### 2. ุงูู Cache ุดุบุงู ุจููุงุกุฉ

```typescript
staleTime: 1000 * 60 * 5,  // 5 ุฏูุงุฆู
gcTime: 1000 * 60 * 10,    // 10 ุฏูุงุฆู
```

**ูุนูู ุฏู:**
- ูู ูุชุญุช ุงูููุชุฌ 14 ูุฑุฉ ุชุงููุฉ ุฎูุงู 5 ุฏูุงุฆู โ **ูุด ููุนูู request**
- ุงูุจูุงูุงุช ูุชูุฌู ูู ุงูู cache ููุฑุงู
- ุจุนุฏ 5 ุฏูุงุฆู โ ููุนูู request ุฌุฏูุฏ ูู ูุชุญุช ุงูููุชุฌ ุชุงูู

---

## ๐งช ุงุฎุชุจุงุฑ ุงูู Cache

### ุงูุชุฌุฑุจุฉ 1: ูุชุญ ููุณ ุงูููุชุฌ ูุฑุชูู

```
1. ุงูุชุญ ุงูููุชุฌ 14 โ โ Request
2. ุงููู ุงูููุฏุงู
3. ุงูุชุญ ุงูููุชุฌ 14 ุชุงูู (ุฎูุงู 5 ุฏูุงุฆู) โ โ No Request (ูู ุงูู cache)
```

**ุงููุชูุฌุฉ ูู ุงูููุฌุฒ:**
```
๐ก API Request [GET]: /products/14  โ ุงููุฑุฉ ุงูุฃููู ููุท
(ูุง ููุฌุฏ request ูู ุงููุฑุฉ ุงูุซุงููุฉ)
```

---

### ุงูุชุฌุฑุจุฉ 2: ูุชุญ ููุชุฌุงุช ูุฎุชููุฉ

```
1. ุงูุชุญ ุงูููุชุฌ 14 โ โ Request
2. ุงูุชุญ ุงูููุชุฌ 13 โ โ Request
3. ุงูุชุญ ุงูููุชุฌ 12 โ โ Request
```

**ุงููุชูุฌุฉ:** 3 requests ูู 3 ููุชุฌุงุช ูุฎุชููุฉ โ **ุทุจูุนู ุฌุฏุงู**

---

### ุงูุชุฌุฑุจุฉ 3: ูุชุญ ููุณ ุงูููุชุฌ ุจุนุฏ 5 ุฏูุงุฆู

```
1. ุงูุชุญ ุงูููุชุฌ 14 โ โ Request
2. ุงูุชุธุฑ 6 ุฏูุงุฆู
3. ุงูุชุญ ุงูููุชุฌ 14 ุชุงูู โ โ Request ุฌุฏูุฏ (ุงูุจูุงูุงุช stale)
```

**ูููุ**
- ุจุนุฏ 5 ุฏูุงุฆูุ ุงูุจูุงูุงุช ุชุนุชุจุฑ "ูุฏููุฉ" (stale)
- React Query ูุนูู fetch ุฌุฏูุฏ ูุชุญุฏูุซ ุงูุจูุงูุงุช

---

## ๐ ููุงุฑูุฉ: ูุน ูุจุฏูู Cache

### ุจุฏูู Cache (ุณูุก โ):
```
ูุชุญ ุงูููุชุฌ 14 โ Request
ุงููู ุงูููุฏุงู
ูุชุญ ุงูููุชุฌ 14 โ Request โ ุงุณุชููุงู ุนูู ุงููุงุถู!
ุงููู ุงูููุฏุงู
ูุชุญ ุงูููุชุฌ 14 โ Request โ ุงุณุชููุงู ุนูู ุงููุงุถู!
```
**ุงููุชูุฌุฉ:** 3 requests ูููุณ ุงูููุชุฌ ูู ุฏูููุฉ ูุงุญุฏุฉ!

---

### ูุน Cache (ููุชุงุฒ โ):
```
ูุชุญ ุงูููุชุฌ 14 โ Request
ุงููู ุงูููุฏุงู
ูุชุญ ุงูููุชุฌ 14 โ ูู ุงูู Cache โ ุณุฑูุน!
ุงููู ุงูููุฏุงู
ูุชุญ ุงูููุชุฌ 14 โ ูู ุงูู Cache โ ุณุฑูุน!
```
**ุงููุชูุฌุฉ:** Request ูุงุญุฏ ููุท!

---

## ๐ฏ ุงูู Query Key

```typescript
queryKey: ['product', product?.id, 'detailed']
```

**ุฃูุซูุฉ:**
```
ุงูููุชุฌ 14 โ ['product', '14', 'detailed']
ุงูููุชุฌ 13 โ ['product', '13', 'detailed']
ุงูููุชุฌ 12 โ ['product', '12', 'detailed']
```

**ูู query key = cache ูููุตู**

---

## ๐ก ููู ูุด ูุฌูุจ ูู ุงูููุชุฌุงุช ูุฑุฉ ูุงุญุฏุฉุ

### ุงูุฎูุงุฑ 1: Fetch ูู ุงูููุชุฌุงุช (ุณูุก โ)
```typescript
// ุฌูุจ ูู ุงูููุชุฌุงุช ูุน ุงูู addons
const products = await getProducts({ expand: ['addons'] })
```

**ุงููุดุงูู:**
- โ Request ูุจูุฑ ุฌุฏุงู (ูู ุงูููุชุฌุงุช + ูู ุงูู addons)
- โ ุจุทูุก (ูููู 5-10 ุซูุงูู)
- โ ุงุณุชููุงู bandwidth ูุจูุฑ
- โ ุงููุณุชุฎุฏู ูุด ูุญุชุงุฌ ูู ุงูููุชุฌุงุช

**ูุซุงู:**
```
ุนูุฏู 50 ููุชุฌ ร 5 addons ููู ููุชุฌ = 250 addon
ุงููุณุชุฎุฏู ุจููุชุญ ููุชุฌ ูุงุญุฏ ุจุณ!
```

---

### ุงูุฎูุงุฑ 2: Fetch on-demand (ููุชุงุฒ โ)
```typescript
// ุฌูุจ ุงูููุชุฌ ููุง ุงููุณุชุฎุฏู ููุชุญู
const product = await getProduct(id, { expand: ['addons'] })
```

**ุงููููุฒุงุช:**
- โ Request ุตุบูุฑ (ููุชุฌ ูุงุญุฏ ููุท)
- โ ุณุฑูุน (ุฃูู ูู ุซุงููุฉ)
- โ ุงุณุชููุงู bandwidth ูููู
- โ ุงููุณุชุฎุฏู ูุดูู ุงูุจูุงูุงุช ููุฑุงู

---

## ๐ ุฅุญุตุงุฆูุงุช

### ุณููุงุฑูู ูุงูุนู:

**ุงููุณุชุฎุฏู ูุชุตูุญ ุงููููุน:**
```
1. ููุชุญ ุงูููุชุฌ 14 โ Request (200ms)
2. ูููู ุงูููุฏุงู
3. ููุชุญ ุงูููุชุฌ 13 โ Request (200ms)
4. ูููู ุงูููุฏุงู
5. ููุชุญ ุงูููุชุฌ 14 ุชุงูู โ Cache (0ms) โ ุณุฑูุน!
6. ูุถูู ููุณูุฉ
```

**ุงููุชูุฌุฉ:**
- 2 requests ููุท
- Request ูุงุญุฏ ูู ุงูู cache
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณุฑูุนุฉ

---

### ุจุฏูู Cache:

```
1. ููุชุญ ุงูููุชุฌ 14 โ Request (200ms)
2. ูููู ุงูููุฏุงู
3. ููุชุญ ุงูููุชุฌ 13 โ Request (200ms)
4. ูููู ุงูููุฏุงู
5. ููุชุญ ุงูููุชุฌ 14 ุชุงูู โ Request (200ms) โ ุจุทูุก!
6. ูุถูู ููุณูุฉ
```

**ุงููุชูุฌุฉ:**
- 3 requests
- ุงุณุชููุงู ุฃูุซุฑ
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃุจุทุฃ

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ

```typescript
staleTime: 1000 * 60 * 5,  // 5 ุฏูุงุฆู
gcTime: 1000 * 60 * 10,    // 10 ุฏูุงุฆู
```

### staleTime (5 ุฏูุงุฆู):
- ุงูุจูุงูุงุช ุชุนุชุจุฑ "ุทุงุฒุฌุฉ" ููุฏุฉ 5 ุฏูุงุฆู
- ุฎูุงู 5 ุฏูุงุฆู: ูุด ููุนูู request ุฌุฏูุฏ
- ุจุนุฏ 5 ุฏูุงุฆู: ููุนูู request ูุชุญุฏูุซ ุงูุจูุงูุงุช

### gcTime (10 ุฏูุงุฆู):
- ุงูุจูุงูุงุช ุชุจูู ูู ุงูู memory ููุฏุฉ 10 ุฏูุงุฆู
- ุจุนุฏ 10 ุฏูุงุฆู: ุชุชูุณุญ ูู ุงูู memory
- ูู ุงููุณุชุฎุฏู ุฑุฌุน ุจุนุฏ 10 ุฏูุงุฆู: ููุนูู request ุฌุฏูุฏ

---

## ๐ฏ ูู ุงูุฅุนุฏุงุฏุงุช ุฏู ููุงุณุจุฉุ

### โ ูุนู! ููุชุงุฒุฉ

**ูููุ**
- 5 ุฏูุงุฆู ูุงููุฉ ููุชุตูุญ ุงูุนุงุฏู
- ุงูููุชุฌุงุช ูุด ุจุชุชุบูุฑ ูู ุฏูููุฉ
- ุชูุงุฒู ุจูู ุงูุณุฑุนุฉ ูุงูุจูุงูุงุช ุงูุญุฏูุซุฉ

---

### ุฎูุงุฑุงุช ุฃุฎุฑู:

#### ููุจูุงูุงุช ุงูุฏููุงููููุฉ ุฌุฏุงู:
```typescript
staleTime: 1000 * 30,  // 30 ุซุงููุฉ
```

#### ููุจูุงูุงุช ุงูุซุงุจุชุฉ:
```typescript
staleTime: 1000 * 60 * 30,  // 30 ุฏูููุฉ
```

---

## ๐ ุชุญุณููุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)

### 1. Prefetch ุงูููุชุฌุงุช ุงูุดุงุฆุนุฉ

```typescript
// ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
useEffect(() => {
  // Prefetch ุฃูู 3 ููุชุฌุงุช
  topProducts.forEach(product => {
    queryClient.prefetchQuery({
      queryKey: ['product', product.id, 'detailed'],
      queryFn: () => getProduct(product.id, { expand: ['addons'] })
    })
  })
}, [topProducts])
```

**ุงููุงุฆุฏุฉ:**
- ุงูููุชุฌุงุช ุงูุดุงุฆุนุฉ ุชููู ุฌุงูุฒุฉ ูู ุงูู cache
- ุงููุณุชุฎุฏู ููุชุญ ุงูููุฏุงู ููุฑุงู ุจุฏูู ุงูุชุธุงุฑ

---

### 2. Background Refetch

```typescript
refetchOnWindowFocus: true,  // ุชุญุฏูุซ ููุง ุงููุณุชุฎุฏู ูุฑุฌุน ููุชุงุจ
refetchOnReconnect: true,    // ุชุญุฏูุซ ููุง ุงูุฅูุชุฑูุช ูุฑุฌุน
```

**ุงููุงุฆุฏุฉ:**
- ุงูุจูุงูุงุช ุฏุงุฆูุงู ูุญุฏุซุฉ
- ุงููุณุชุฎุฏู ูุดูู ุขุฎุฑ ุงูุชุญุฏูุซุงุช

---

## ๐ ุงูุฎูุงุตุฉ

### โ ุงููุถุน ุงูุญุงูู ููุชุงุฒ:

1. **ูู ููุชุฌ = Request ูุงุญุฏ ููุท**
2. **ุงูู Cache ุดุบุงู ุจููุงุกุฉ (5 ุฏูุงุฆู)**
3. **ูุด ูู ุงุณุชููุงู ุนูู ุงููุงุถู**
4. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณุฑูุนุฉ**

---

### ๐ฏ ูุง ุชุดููู ูู ุงูููุฌุฒ ุทุจูุนู:

```
5 ููุชุฌุงุช ูุฎุชููุฉ = 5 requests
```

**ูู ูุชุญุช ููุณ ุงูููุชุฌ ุชุงูู ุฎูุงู 5 ุฏูุงุฆู:**
```
0 requests โ ูู ุงูู cache
```

---

## ๐งช ููู ุชุชุฃูุฏุ

### ุงูุชุฌุฑุจุฉ:

1. **ุงูุชุญ ุงูููุชุฌ 14**
   - ุดูู ุงูููุฌุฒ: `๐ก API Request [GET]: /products/14`

2. **ุงููู ุงูููุฏุงู**

3. **ุงูุชุญ ุงูููุชุฌ 14 ุชุงูู (ุฎูุงู ุฏูููุฉ)**
   - ุดูู ุงูููุฌุฒ: **ูุด ูุชูุงูู request ุฌุฏูุฏ!**
   - ุงูุจูุงูุงุช ุฌุช ูู ุงูู cache

4. **ุงูุชุธุฑ 6 ุฏูุงุฆู**

5. **ุงูุชุญ ุงูููุชุฌ 14 ุชุงูู**
   - ุดูู ุงูููุฌุฒ: `๐ก API Request [GET]: /products/14`
   - Request ุฌุฏูุฏ ูุชุญุฏูุซ ุงูุจูุงูุงุช

---

## ๐ก ูุตูุญุฉ

**ูู ุนุงูุฒ ุชุดูู ุงูู cache ุดุบุงู:**

ุงูุชุญ DevTools โ Network โ ุงูููู
ุงูุชุญ ุงูููุชุฌ 14 โ ุงููู ุงูููุฏุงู โ ุงูุชุญ ุงูููุชุฌ 14 ุชุงูู

**ูุชูุงูู:**
- ุงูููุฏุงู ูุชุญ ููุฑุงู
- ูุด ูู request ูู ุงูู Network tab
- ุงูุจูุงูุงุช ุฌุช ูู ุงูู cache

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

**ุงูููุฏ ุงูุญุงูู ูุญุณูู ููุด ูุญุชุงุฌ ุชุนุฏูู!** ๐

- โ Caching ุฐูู
- โ Performance ููุชุงุฒ
- โ UX ุณุฑูุน
- โ ุงุณุชููุงู ูุนููู ููู API
