# Requirements Document - Admin UI Redesign

## ๐ฏ ุงููุฏู

ุฅุนุงุฏุฉ ุชุตููู ูุงุฌูุฉ ุงูุฃุฏูู ุจูููุฌูุฉ **ุซูุงุฆูุฉ ุงููุณุงุฑ** (Admin + Customer) ูู **ููุจุน ูุงุญุฏ** (Backend):

1. **ููู Backend ุฃููุงู** - Schema + Endpoints
2. **ุชุญููู ุงูููุฏ ุงูููุฌูุฏ** - ูุง ููุฑุฑ ูุง ุชู ุฅุตูุงุญู
3. **ุชูุงูู Admin โ Customer** - ููุณ ุงูุจูุงูุงุชุ ุนุฑุถ ูุฎุชูู
4. **ุชูุซูู ุดุงูู** - ููู Agent ูุงููุทูุฑูู

---

## ๐ ุงููููุฌูุฉ ุงูุซูุงุฆูุฉ

```
                    โโโโโโโโโโโโโโโโโโโ
                    โ    Backend      โ
                    โ   (ุงูููุจุน)      โ
                    โ   schema.sql    โ
                    โ   routes/*.js   โ
                    โโโโโโโโโโฌโโโโโโโโโ
                             โ
              โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
              โ                             โ
              โผ                             โผ
    โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ
    โ   Admin Path    โ           โ  Customer Path  โ
    โ  /admin/...     โ           โ  /products/...  โ
    โ  lib/admin/     โ           โ  lib/api.ts     โ
    โโโโโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโโโโ
```

### ููุงุฐุง ูุฐู ุงููููุฌูุฉุ
- **ููุจุน ูุงุญุฏ:** ุงูุจูุงูุงุช ุชุฃุชู ูู ููุณ ุงูุฌุฏุงูู
- **ุชุฌูุจ ุงูุชูุฑุงุฑ:** ูุง ูุตูุญ ููุณ ุงููุดููุฉ ูุฑุชูู
- **ุงูุชุดุงู ุงูุฃุฎุทุงุก:** ูุฑู ุงูุชูุงูุถุงุช ุจูู Admin ู Customer
- **ุณูุงู ุฃููู:** ุงูู Agent ูููู ุงูุตูุฑุฉ ุงููุงููุฉ

---

## ๐ ุงููุฑุฌุนูุฉ ุงูุฃุณุงุณูุฉ (MUST READ FIRST)

### ูููุงุช ุงูุชูุซูู ุงููุทููุจ ูุฑุงุกุชูุง ูุจู ุฃู ูููุฉ:

| ุงูููู | ุงููููุน | ุงูุบุฑุถ |
|-------|--------|-------|
| Schema ุงูุญูููู | `softcream-api/schema.sql` | ุงูุฌุฏุงูู ูุงูุนูุงูุงุช ุงููุนููุฉ |
| Backend Architecture | `softcream-api/src/database/BACKEND_ARCHITECTURE.md` | ููุฏุณุฉ ุงูุจุงู ุงูุฏ |
| Admin Compatibility | `softcream-api/docs/BACKEND_ADMIN_COMPATIBILITY.md` | ุชูุงูู ุงูู API |
| Products Relationships | `softcream-api/src/routes/admin/PRODUCTS_OPTIONS_RELATIONSHIPS.md` | ุนูุงูุงุช ุงูุฌุฏุงูู |
| Frontend Architecture | `soft-cream-nextjs/src/components/admin/products/ARCHITECTURE.md` | ููุฏุณุฉ ุงููุฑููุช |
| Template System | `soft-cream-nextjs/src/components/admin/products/TEMPLATE_SYSTEM_GUIDE.md` | ูุธุงู ุงูููุงูุจ |

### ูููุงุช ุงูู API:

| ุงูููู | ุงููููุน | ุงูุบุฑุถ |
|-------|--------|-------|
| Admin Products API | `softcream-api/src/routes/admin/products.js` | Endpoints ุงูุฃุฏูู |
| Admin Options API | `softcream-api/src/routes/admin/options.js` | Endpoints ุงูุฎูุงุฑุงุช |
| Customer Products API | `softcream-api/src/routes/products.js` | Endpoints ุงูุนููู |
| Admin API Client | `soft-cream-nextjs/src/lib/admin/products.api.ts` | Frontend Admin |
| Customer API Client | `soft-cream-nextjs/src/lib/api.ts` | Frontend Customer |

---

## ๐ ุชูุงูู Admin โ Customer

### ููุณ ุงูุจูุงูุงุชุ ุนุฑุถ ูุฎุชูู:

| ุงูุจูุงูุงุช | Admin ูุญูุธ | Customer ููุฑุฃ |
|----------|-----------|---------------|
| ุงูููุชุฌ | `POST /admin/products` | `GET /products/:id` |
| ุงูุฎูุงุฑุงุช | `POST /admin/options` | `GET /products/:id/configuration` |
| ุงููุงูุจ | `template_id` ูู ุงูููุชุฌ | ูุญุฏุฏ ุดูู ุงูุจุทุงูุฉ ูุงูู Modal |

### ุงูู Endpoints ุงููุชูุงุฒูุฉ:

```
Admin                              Customer
โโโโโ                              โโโโโโโโ
GET  /admin/products               GET  /products
GET  /admin/products/:id/full      GET  /products/:id/configuration
POST /admin/products               (ูุง ููุฌุฏ - Admin ููุท)
PUT  /admin/products/:id           (ูุง ููุฌุฏ - Admin ููุท)
GET  /admin/options                GET  /products/:id/customization-rules
```

### ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ:
> **ูุง ูุญูุธู Admin ูุฌุจ ุฃู ููุฑุฃู Customer ุจุดูู ุตุญูุญ**

---

## ๐๏ธ Phase 0: ุชุญููู Backend (ูุจู ุฃู ุชุนุฏูู)

### Requirement 0.1: ููู Schema ุงูุญูููู

**ุงููุฏู:** ุงูุชุฃูุฏ ูู ููู ุงูุฌุฏุงูู ูุงูุนูุงูุงุช ุงููุนููุฉ

#### ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ ููููุชุฌุงุช ูุงูุฎูุงุฑุงุช:

```sql
-- 1. products: ุงูููุชุฌุงุช
-- ุงูุญููู ุงููููุฉ: id, name, template_id, ui_config, price, available

-- 2. option_groups: ูุฌููุนุงุช ุงูุฎูุงุฑุงุช
-- ุงูุญููู ุงููููุฉ: id, name_ar, name_en, is_required, min_selections, max_selections

-- 3. options: ุงูุฎูุงุฑุงุช ุงููุฑุฏูุฉ
-- ุงูุญููู ุงููููุฉ: id, group_id, name_ar, name_en, base_price, available, calories

-- 4. product_options: ุฑุจุท ุงูููุชุฌุงุช ุจูุฌููุนุงุช ุงูุฎูุงุฑุงุช
-- โ๏ธ ููู: ูุณุชุฎุฏู option_group_id (ูููุณ group_id)
-- ุงูุญููู: product_id, option_group_id, is_required, min_selections, max_selections
```

#### Acceptance Criteria

1. BEFORE ุฃู ุชุนุฏูู ุนูู ุงููุฑููุช THEN ุงูู Agent SHALL ููุฑุฃ `schema.sql` ููููู:
   - ุฃุณูุงุก ุงูุฃุนูุฏุฉ ุงููุนููุฉ
   - ุงูุนูุงูุงุช ุจูู ุงูุฌุฏุงูู
   - ุงููููุฏ (FOREIGN KEY, UNIQUE)

2. WHEN ุงูู Agent ูุญุชุงุฌ ูุนุฑูุฉ ุนููุฏ THEN SHALL ูุชุญูู ูู `schema.sql` ูููุณ ูู ุงูุชุฑุงุถุงุช

---

### Requirement 0.2: ุงุฎุชุจุงุฑ Endpoints ุงููุนููุฉ

**ุงููุฏู:** ุงูุชุฃูุฏ ูู ุฃู ุงูู API ุชุนูู ููุง ูู ูุชููุน

#### Endpoints ุงููุทููุจ ุงุฎุชุจุงุฑูุง:

| Endpoint | Method | ุงูุบุฑุถ | ููู ุงูู Handler |
|----------|--------|-------|-----------------|
| `/admin/options` | GET | ุฌูุจ ุงููุฌููุนุงุช ูุน ุงูุฎูุงุฑุงุช | `routes/admin/options.js` |
| `/admin/products` | GET | ุฌูุจ ุงูููุชุฌุงุช | `routes/admin/products.js` |
| `/admin/products/:id/full` | GET | ุฌูุจ ููุชุฌ ูุน ูู ุงูุนูุงูุงุช | `routes/admin/products.js` |

#### Acceptance Criteria

1. BEFORE ุชุนุฏูู ุฃู API call ูู ุงููุฑููุช THEN ุงูู Agent SHALL:
   - ููุฑุฃ ุงูู Handler ูู ุงูุจุงู ุงูุฏ
   - ูููู ุดูู ุงูู Response ุงููุนูู
   - ูุชุญูู ูู ุฃุณูุงุก ุงูุญููู

2. WHEN ุงูู API ุชุฑุฌุน ุจูุงูุงุช THEN ุงูู Agent SHALL ูุชุญูู ูู:
   - ูู `options` ููุฌูุฏ ูู ูู `group`ุ
   - ูู ุงูุฃุณูุงุก ูุชุทุงุจูุฉ (camelCase vs snake_case)ุ
   - ูู ููุงู ุญููู null ูุญุชููุฉุ

---

### Requirement 0.3: ุชูุซูู ุงูุนูุงูุงุช ุงููุนููุฉ

**ุงููุฏู:** ุฅูุดุงุก ูุฑุฌุน ูุงุถุญ ููุนูุงูุงุช

#### ุงูุนูุงูุงุช ุงูุฃุณุงุณูุฉ:

```
products (1) โโ (N) product_options (N) โโ (1) option_groups
                                              โ
                                         (1) โโ (N) options
```

#### Acceptance Criteria

1. WHEN ุงูู Agent ูุนุฏู ููู ูุชุนุงูู ูุน ุงูุนูุงูุงุช THEN SHALL ูุฑุฌุน ููุฐุง ุงููุฎุทุท

2. WHEN ุงูู Agent ููุชุจ query ุฃู API call THEN SHALL ูุณุชุฎุฏู:
   - `option_group_id` (ูููุณ `group_id`) ูู `product_options`
   - `group_id` ูู `options` (ููุฑุจุท ุจู `option_groups`)

---

## ๐ง Phase 1: ุฅุตูุงุญ ุงููุดุงูู ุงูุญุงููุฉ

### Requirement 1.1: ุฅุตูุงุญ `group.options` undefined

**ุงููุดููุฉ:** ุงูู Backend ูุฏ ููุฑุฌุน ูุฌููุนุงุช ุจุฏูู `options` array

**ุงููููุงุช ุงููุชุฃุซุฑุฉ:**
- `src/components/admin/options/index.tsx`
- `src/components/admin/options/OptionGroupCard.tsx`
- `src/components/admin/options/OptionsTable.tsx`

#### Acceptance Criteria

1. WHEN ุงูููุฏ ูุชุนุงูู ูุน `group.options` THEN SHALL ูุณุชุฎุฏู:
   ```typescript
   (group.options || []).map(...)
   group.options?.length ?? 0
   ```

2. WHEN ุงูู Agent ูุนุฏู ููู THEN SHALL ูุจุญุซ ุนู ูู ุงุณุชุฎุฏุงูุงุช `.options` ููุถูู null check

3. AFTER ุงูุฅุตูุงุญ THEN ุงูู Agent SHALL ูุดุบู `getDiagnostics` ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก TypeScript

---

### Requirement 1.2: ุฅุฒุงูุฉ ุงูุญููู ุงููุฏููุฉ

**ุงูุญููู ุงูููููุฉ (ูู ุชุนุฏ ูู schema.sql):**
- `product_type`
- `card_style`
- `layout_mode`

**ุงูุญูู ุงูุตุญูุญ:** `template_id` ููุท

#### Acceptance Criteria

1. WHEN ุงูู Agent ูุนุฏู ููุฑู ุงูููุชุฌ THEN SHALL:
   - ูุฒูู ุฃู ุญูู `product_type`
   - ูุฒูู ุฃู ุญูู `card_style`
   - ูุฒูู ุฃู ุญูู `layout_mode`
   - ูุณุชุฎุฏู `template_id` ููุท

2. BEFORE ุฅุฒุงูุฉ ุญูู THEN ุงูู Agent SHALL ูุชุญูู ูู `schema.sql` ุฃูู ูุนูุงู ุบูุฑ ููุฌูุฏ

---

## ๐ฑ Phase 2: ุชุญููู ุงูุฌุฏูู ุฅูู ุจุทุงูุงุช

### Requirement 2.1: ุชุตููู OptionCard ุงููุชุฌุงูุจ

**ุงููุฏู:** ุงุณุชุจุฏุงู `OptionsTable.tsx` ุจุจุทุงูุงุช ูุชุฌุงูุจุฉ

#### Acceptance Criteria

1. WHEN ุงูุฃุฏูู ููุชุญ ุตูุญุฉ ุงูุฎูุงุฑุงุช THEN ุงููุธุงู SHALL ูุนุฑุถ:
   - ุจุทุงูุงุช ูู grid ูุชุฌุงูุจ
   - 1 ุนููุฏ ุนูู ุงูููุจุงูู
   - 2 ุฃุนูุฏุฉ ุนูู ุงูุชุงุจูุช
   - 3-4 ุฃุนูุฏุฉ ุนูู ุงูุฏูุณูุชูุจ

2. WHEN ุงูุจุทุงูุฉ ุชูุนุฑุถ THEN SHALL ุชุญุชูู ุนูู:
   - ุงูุงุณู (ุนุฑุจู + ุฅูุฌููุฒู)
   - ุงูุณุนุฑ
   - ุญุงูุฉ ุงูุชููุฑ (toggle)
   - ุฒุฑ ุชุนุฏูู

3. WHEN ุงูุฃุฏูู ูุถุบุท "ุชุนุฏูู" THEN ุงูุจุทุงูุฉ SHALL ุชุชูุณุน ูุชุนุฑุถ:
   - ุฌููุน ุงูุญููู ุงููุงุจูุฉ ููุชุนุฏูู
   - ุงูููู ุงูุบุฐุงุฆูุฉ
   - ุฒุฑ ุญูุธ + ุฒุฑ ุฅูุบุงุก

---

### Requirement 2.2: Optimistic Updates

**ุงููุฏู:** ุชุญุฏูุซ ุงููุงุฌูุฉ ููุฑุงู ูุน ุงูุชุฑุงุฌุน ุนูุฏ ุงููุดู

#### Acceptance Criteria

1. WHEN ุงูุฃุฏูู ูุบูุฑ ูููุฉ THEN ุงููุธุงู SHALL:
   - ูุญุฏุซ ุงููุงุฌูุฉ ููุฑุงู
   - ูุฑุณู ุงูุทูุจ ููู API
   - ููุธูุฑ ูุคุดุฑ ุญูุธ ุตุบูุฑ

2. WHEN ุงูู API ุชูุดู THEN ุงููุธุงู SHALL:
   - ููุฑุฌุน ุงููููุฉ ุงููุฏููุฉ
   - ูุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ

---

## ๐ Phase 3: ุชุจุณูุท ููุฑู ุงูููุชุฌ

### Requirement 3.1: ุฏูุฌ ุงูุชุจููุจุงุช

**ุงูุญุงูู:** 5 ุชุจููุจุงุช
**ุงููุทููุจ:** 3 ุชุจููุจุงุช

| ุงูุชุจููุจ ุงูุฌุฏูุฏ | ุงููุญุชูู |
|----------------|---------|
| ุงูุฃุณุงุณูุงุช | ุงูุงุณูุ ุงููุตูุ ุงููุฆุฉุ ุงูุณุนุฑุ ุงูุตูุฑุฉุ ุงููุงูุจุ ุงูุฎุตู |
| ุงูุฎูุงุฑุงุช | ูุฌููุนุงุช ุงูุฎูุงุฑุงุช ุงููุฑุชุจุทุฉ |
| ุงูุชุบุฐูุฉ | ุงูููู ุงูุบุฐุงุฆูุฉุ ุงูุดุงุฑุงุช ุงูุตุญูุฉ |

#### Acceptance Criteria

1. WHEN ุงูู Agent ูุนุฏู `UnifiedProductForm/index.tsx` THEN SHALL:
   - ูุฏูุฌ ุชุจููุจ "ุงููุงูุจ" ูุน "ุงูุฃุณุงุณูุงุช"
   - ูุฏูุฌ ุชุจููุจ "ุฅุนุฏุงุฏุงุช ุงูุนุฑุถ" ูุน "ุงูุฃุณุงุณูุงุช"
   - ูุญุงูุธ ุนูู ุชุจููุจ "ุงูุฎูุงุฑุงุช" ููุง ูู
   - ูุญุงูุธ ุนูู ุชุจููุจ "ุงูุชุบุฐูุฉ" ููุง ูู

2. AFTER ุงูุฏูุฌ THEN ุงูู Agent SHALL ูุชุญูู ูู:
   - ุฌููุน ุงูุญููู ููุฌูุฏุฉ
   - ุงูู validation ูุนูู
   - ุงูุญูุธ ูุนูู

---

### Requirement 3.2: ูุนุงููุฉ ุงููุงูุจ

**ุงููุฏู:** ุนุฑุถ ุดูู ุงูุจุทุงูุฉ ุนูุฏ ุงุฎุชูุงุฑ ุงููุงูุจ

#### Acceptance Criteria

1. WHEN ุงูุฃุฏูู ูุฎุชุงุฑ ูุงูุจ THEN ุงููุธุงู SHALL ูุนุฑุถ:
   - ูุตู ุงููุงูุจ
   - ูุนุงููุฉ ูุตุบุฑุฉ ูุดูู ุงูุจุทุงูุฉ
   - ุนุฏุฏ ูุฌููุนุงุช ุงูุฎูุงุฑุงุช ุงูููุตู ุจูุง

---

## ๐งช Phase 4: ุงูุงุฎุชุจุงุฑ ูุงูุชุญูู

### Requirement 4.1: ุงุฎุชุจุงุฑ ุงูุชูุงูู

**ุงููุฏู:** ุงูุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู ูุนุงู

#### Acceptance Criteria

1. AFTER ูู ุชุนุฏูู THEN ุงูู Agent SHALL:
   - ูุดุบู `getDiagnostics` ุนูู ุงููููุงุช ุงููุนุฏูุฉ
   - ูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก TypeScript
   - ูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ESLint

2. WHEN ุงูู Agent ููุชูู ูู Phase THEN SHALL:
   - ููุซู ูุง ุชู ุฅูุฌุงุฒู
   - ูุญุฏุซ ูููุงุช ุงูุชูุซูู ุฅุฐุง ูุฒู ุงูุฃูุฑ

---

## ๐ ูููุงุช ุงูุชูุซูู ุงููุทููุจ ุชุญุฏูุซูุง

### ุนูุฏ ุฅููุงุก ุงูููุงู:

| ุงูููู | ูุชู ููุญุฏุซ |
|-------|-----------|
| `ARCHITECTURE.md` (Frontend) | ุนูุฏ ุชุบููุฑ ูููู ุงููููุงุช |
| `BACKEND_ADMIN_COMPATIBILITY.md` | ุนูุฏ ุชุบููุฑ ุงูู API calls |
| `design.md` | ุนูุฏ ุฅุถุงูุฉ ููููุงุช ุฌุฏูุฏุฉ |

---

## ๐จ ููุงุนุฏ ุตุงุฑูุฉ ููู Agent

### ูุจู ุฃู ุชุนุฏูู:

1. **ุงูุฑุฃ ุงููููุงุช ุงููุฑุฌุนูุฉ** ุงููุฐููุฑุฉ ูู Phase 0
2. **ุชุญูู ูู schema.sql** ูุฃุณูุงุก ุงูุฃุนูุฏุฉ ุงููุนููุฉ
3. **ุงูุฑุฃ ุงูู Handler** ูู ุงูุจุงู ุงูุฏ ูุจู ุชุนุฏูู API call

### ุฃุซูุงุก ุงูุชุนุฏูู:

4. **ุงุณุชุฎุฏู null checks** ุฏุงุฆูุงู ูุน ุงูุจูุงูุงุช ูู ุงูู API
5. **ุดุบู getDiagnostics** ุจุนุฏ ูู ุชุนุฏูู
6. **ูุง ุชูุชุฑุถ** - ุชุญูู ูู ุงูููุฏ ุงููุนูู

### ุจุนุฏ ุงูุชุนุฏูู:

7. **ูุซู ุงูุชุบููุฑุงุช** ูู ุงููููุงุช ุงูููุงุณุจุฉ
8. **ุงุฎุชุจุฑ ุงูุชูุงูู** ูุน ุงูุจุงู ุงูุฏ

---

## ๐ ููุฎุต ุงููุฑุงุญู

| ุงููุฑุญูุฉ | ุงููุฏู | ุงููุฎุฑุฌุงุช |
|---------|-------|----------|
| Phase 0 | ููู Backend | ูุฑุงุกุฉ ูููู Schema + Endpoints |
| Phase 1 | ุฅุตูุงุญ ุงููุดุงูู | null checks + ุฅุฒุงูุฉ ุงูุญููู ุงููุฏููุฉ |
| Phase 2 | ุจุทุงูุงุช ูุชุฌุงูุจุฉ | OptionCard + Optimistic Updates |
| Phase 3 | ุชุจุณูุท ุงูููุฑู | 3 ุชุจููุจุงุช + ูุนุงููุฉ ุงููุงูุจ |
| Phase 4 | ุงุฎุชุจุงุฑ | ุชูุงูู + ุชูุซูู |

---

## ๐ฏ ูุนุงููุฑ ุงููุฌุงุญ

1. โ ูุง ุฃุฎุทุงุก TypeScript
2. โ ูุง ุฃุฎุทุงุก ESLint
3. โ ุงููุงุฌูุฉ ูุชุฌุงูุจุฉ ุนูู ุฌููุน ุงูุดุงุดุงุช
4. โ ุงูู API calls ุชุนูู ุจุดูู ุตุญูุญ
5. โ ุงูุชูุซูู ูุญุฏุซ
