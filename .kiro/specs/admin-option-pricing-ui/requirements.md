# Requirements Document

## Introduction

هذا المستند يحدد متطلبات تحسين واجهة إدارة أسعار الخيارات (Option Pricing) في لوحة الأدمن، بالإضافة إلى التحقق من نظام الخصومات على المنتجات.

### المشكلة الحالية - تخصيص أسعار الخيارات
- الـ `priceOverride` موجود في `OptionGroupAssignment` interface
- الـ Backend يدعم `price_override` في جدول `product_options`
- لكن `OptionGroupsSection.tsx` لا يعرض حقل تخصيص السعر
- المسؤول لا يستطيع تحديد سعر مختلف للخيارات (مثل النكهات بسعر 0)

### الوضع الحالي - نظام الخصومات
- ✅ الأدمن: حقول `old_price` و `discount_percentage` موجودة في `ProductDetailsSection`
- ✅ الأدمن: حساب تلقائي لنسبة الخصم عند إدخال السعر القديم
- ✅ الأدمن: معاينة الخصم مع عرض التوفير
- ✅ Frontend: `DiscountBadge` يعرض نسبة الخصم على البطاقة
- ✅ Frontend: `PriceDisplay` يعرض السعر القديم مشطوب والسعر الجديد

### الهدف
تمكين المسؤول من:
1. تخصيص أسعار الخيارات لكل منتج (priceOverride)
2. تحديد خيارات بسعر 0 (مثل النكهات، الأحجام الثابتة)
3. رؤية واضحة لتأثير الخيارات على السعر
4. التحقق من عمل نظام الخصومات بشكل صحيح

## Glossary

- **Option Group**: مجموعة خيارات (مثل: النكهات، الأحجام، الإضافات)
- **Option**: خيار فردي داخل المجموعة (مثل: فانيليا، شوكولاتة)
- **priceOverride**: سعر مخصص للخيار يتجاوز السعر الأساسي
- **base_price**: السعر الأساسي للخيار المحدد في جدول `options`
- **Admin Panel**: لوحة تحكم المسؤول (Next.js)
- **Product-Option Assignment**: ربط منتج بمجموعة خيارات مع إعدادات مخصصة

## Requirements

### Requirement 1: عرض حقل تخصيص السعر

**User Story:** كمسؤول، أريد رؤية حقل لتخصيص سعر الخيارات عند ربط مجموعة خيارات بمنتج، حتى أتمكن من تحديد أسعار مختلفة لكل منتج.

#### Acceptance Criteria

1. WHEN المسؤول يضيف مجموعة خيارات لمنتج THEN النظام SHALL يعرض حقل "تخصيص السعر" (Price Override) بجانب الحقول الأخرى
2. WHEN حقل تخصيص السعر فارغ THEN النظام SHALL يستخدم السعر الأساسي من جدول options
3. WHEN المسؤول يدخل قيمة 0 في حقل تخصيص السعر THEN النظام SHALL يحفظ القيمة 0 ويعتبر الخيارات مجانية
4. WHEN المسؤول يدخل قيمة سالبة THEN النظام SHALL يرفض القيمة ويعرض رسالة خطأ

### Requirement 2: عرض معلومات السعر الأساسي

**User Story:** كمسؤول، أريد رؤية السعر الأساسي للخيارات في المجموعة، حتى أتمكن من اتخاذ قرار مناسب بشأن تخصيص السعر.

#### Acceptance Criteria

1. WHEN المسؤول يعرض مجموعة خيارات مربوطة بمنتج THEN النظام SHALL يعرض السعر الأساسي للمجموعة كمرجع
2. WHEN السعر الأساسي يساوي 0 THEN النظام SHALL يعرض علامة "مجاني" بجانب اسم المجموعة
3. WHEN المسؤول يمرر الماوس على حقل السعر THEN النظام SHALL يعرض tooltip يوضح الفرق بين السعر الأساسي والمخصص

### Requirement 3: التحقق من صحة السعر

**User Story:** كمسؤول، أريد أن يتحقق النظام من صحة السعر المدخل، حتى لا أدخل قيم غير صالحة.

#### Acceptance Criteria

1. WHEN المسؤول يدخل نص غير رقمي في حقل السعر THEN النظام SHALL يرفض الإدخال ويعرض رسالة خطأ
2. WHEN المسؤول يدخل رقم سالب THEN النظام SHALL يعرض تحذير "السعر لا يمكن أن يكون سالباً"
3. WHEN المسؤول يدخل رقم عشري THEN النظام SHALL يقبل القيمة ويحفظها بدقة رقمين عشريين
4. WHEN المسؤول يترك الحقل فارغاً THEN النظام SHALL يعتبر ذلك استخدام السعر الأساسي (null)

### Requirement 4: عرض ملخص التأثير على السعر

**User Story:** كمسؤول، أريد رؤية ملخص لتأثير الخيارات على سعر المنتج النهائي، حتى أفهم كيف ستؤثر إعداداتي على العميل.

#### Acceptance Criteria

1. WHEN المسؤول يعدل إعدادات مجموعة خيارات THEN النظام SHALL يعرض ملخص يوضح نطاق السعر المتوقع
2. WHEN جميع الخيارات في المجموعة بسعر 0 THEN النظام SHALL يعرض علامة "لا تأثير على السعر"
3. WHEN بعض الخيارات لها سعر THEN النظام SHALL يعرض "من X إلى Y ج.م" حسب الخيارات

### Requirement 5: حفظ وتحميل السعر المخصص

**User Story:** كمسؤول، أريد أن يحفظ النظام السعر المخصص بشكل صحيح ويحمله عند التعديل، حتى لا أفقد إعداداتي.

#### Acceptance Criteria

1. WHEN المسؤول يحفظ المنتج مع سعر مخصص THEN النظام SHALL يحفظ القيمة في حقل price_override في جدول product_options
2. WHEN المسؤول يفتح منتج للتعديل THEN النظام SHALL يحمل السعر المخصص المحفوظ مسبقاً
3. WHEN المسؤول يمسح السعر المخصص THEN النظام SHALL يحفظ null ويستخدم السعر الأساسي
4. WHEN المسؤول يحفظ سعر 0 THEN النظام SHALL يحفظ القيمة 0 (وليس null)

### Requirement 6: تمييز الخيارات حسب نوع التسعير

**User Story:** كمسؤول، أريد تمييز بصري واضح بين الخيارات المجانية والمدفوعة، حتى أفهم بسرعة طبيعة كل مجموعة.

#### Acceptance Criteria

1. WHEN مجموعة خيارات لها سعر مخصص 0 THEN النظام SHALL يعرض شارة "مجاني" باللون الأخضر
2. WHEN مجموعة خيارات لها سعر مخصص أكبر من 0 THEN النظام SHALL يعرض السعر باللون الأزرق
3. WHEN مجموعة خيارات تستخدم السعر الأساسي THEN النظام SHALL يعرض "السعر الأساسي" باللون الرمادي
4. WHEN المسؤول يغير السعر THEN النظام SHALL يحدث الشارة فوراً بدون إعادة تحميل



### Requirement 7: التحقق من نظام الخصومات على البطاقات

**User Story:** كمسؤول، أريد التأكد من أن الخصومات تظهر بشكل صحيح على بطاقات المنتجات للعملاء، حتى يرى العملاء العروض بوضوح.

#### Acceptance Criteria

1. WHEN المنتج له `old_price` أكبر من `price` THEN النظام SHALL يعرض شارة الخصم (DiscountBadge) على البطاقة
2. WHEN المنتج له `discount_percentage` THEN النظام SHALL يعرض النسبة المئوية للخصم بشكل واضح
3. WHEN المنتج له سعر قديم THEN النظام SHALL يعرض السعر القديم مشطوب بجانب السعر الجديد
4. WHEN المنتج ليس له خصم THEN النظام SHALL يعرض السعر العادي بدون شارة خصم

### Requirement 8: تناسق عرض الخصم عبر جميع أنواع البطاقات

**User Story:** كمسؤول، أريد أن يظهر الخصم بنفس الطريقة على جميع أنواع بطاقات المنتجات، حتى تكون تجربة العميل متسقة.

#### Acceptance Criteria

1. WHEN المنتج يظهر في SimpleCard THEN النظام SHALL يعرض شارة الخصم والسعر القديم
2. WHEN المنتج يظهر في StandardProductCard THEN النظام SHALL يعرض شارة الخصم والسعر القديم
3. WHEN المنتج يظهر في BYOProductCard THEN النظام SHALL يعرض شارة الخصم والسعر القديم
4. WHEN المنتج يظهر في صفحة التفاصيل THEN النظام SHALL يعرض معلومات الخصم الكاملة

### Requirement 9: أنواع الخيارات حسب التأثير على السعر

**User Story:** كمسؤول، أريد تصنيف الخيارات حسب تأثيرها على السعر، حتى أفهم بسرعة طبيعة كل مجموعة.

#### Acceptance Criteria

1. WHEN مجموعة خيارات جميع خياراتها بسعر 0 THEN النظام SHALL يصنفها كـ "خيارات مجانية" (مثل النكهات)
2. WHEN مجموعة خيارات لها خيارات بأسعار مختلفة THEN النظام SHALL يصنفها كـ "خيارات مدفوعة" (مثل الإضافات)
3. WHEN مجموعة خيارات لها priceOverride = 0 THEN النظام SHALL يعتبر جميع خياراتها مجانية لهذا المنتج
4. WHEN المسؤول يعرض قائمة المجموعات THEN النظام SHALL يعرض أيقونة تدل على نوع التسعير

